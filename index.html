<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>SoundPulse</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui;background:#0a0a0b;color:#fafafa;min-height:100vh}.c{max-width:600px;margin:0 auto;padding:40px 20px;text-align:center}h1{font-size:2.5rem;margin-bottom:8px}p.t{font-size:.7rem;color:#666;text-transform:uppercase;letter-spacing:.2em;margin-bottom:60px}.v{width:200px;height:200px;margin:0 auto 40px;position:relative}.r{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);border-radius:50%;border:1px solid #333}.r:nth-child(1){width:200px;height:200px}.r:nth-child(2){width:150px;height:150px}.r:nth-child(3){width:100px;height:100px}.r:nth-child(4){width:50px;height:50px}.on .r{border-color:#ff3d00;box-shadow:0 0 20px rgba(255,61,0,.4);animation:p 2s infinite}.on .r:nth-child(2){animation-delay:.2s}.on .r:nth-child(3){animation-delay:.4s}@keyframes p{50%{transform:translate(-50%,-50%) scale(1.05);opacity:.7}}button{padding:14px 28px;background:#18181b;border:1px solid #333;border-radius:50px;color:#fff;font-size:.9rem;cursor:pointer}button.on{background:#ff3d00;border-color:#ff3d00}.s{font-size:.7rem;color:#666;margin-top:16px}.s.on{color:#ff3d00}.cards{margin-top:50px;text-align:left}.cards>div{margin-bottom:20px}.l{font-size:.6rem;color:#444;text-transform:uppercase;letter-spacing:.2em;margin-bottom:8px}.card{background:#18181b;border:1px solid #333;border-radius:12px;padding:16px}.card.now{border-color:#ff3d00;box-shadow:0 0 30px rgba(255,61,0,.3)}.card h3{font-size:1.2rem;margin-bottom:4px}.card .a{font-size:.85rem;color:#888}.card .m{font-size:.7rem;color:#555;margin-top:6px}.live{display:inline-block;padding:4px 10px;background:rgba(255,61,0,.1);border-radius:20px;font-size:.6rem;color:#ff3d00;margin-top:8px}.empty{color:#444;font-size:.85rem;padding:20px;text-align:center}.prev{opacity:.7}.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(100px);background:#18181b;border:1px solid #333;padding:12px 20px;border-radius:8px;font-size:.8rem;opacity:0;transition:.3s}.toast.show{transform:translateX(-50%) translateY(0);opacity:1}</style></head><body><div class="c"><h1>SoundPulse</h1><p class="t">Live Music Detection</p><div class="v" id="v"><div class="r"></div><div class="r"></div><div class="r"></div><div class="r"></div></div><button id="b" onclick="go()">Start Listening</button><p class="s" id="st">Tap to begin</p><div class="cards"><div><p class="l">Now Playing</p><div class="card now" id="now"><div class="empty">Start listening to detect music</div></div></div><div><p class="l">Previous</p><div class="card prev" id="prv"><div class="empty">No previous song</div></div></div></div></div><div class="toast" id="toast"></div><script>const API='c10b1d8f685bd6e2cfab394ade1f52fe';let on=0,cur,prv,mr,chunks=[];function go(){on?stop():start()}async function start(){try{const s=await navigator.mediaDevices.getUserMedia({audio:1});on=1;ui();msg("Listening...");mr=new MediaRecorder(s);mr.ondataavailable=e=>{if(e.data.size>0)chunks.push(e.data)};mr.onstop=async()=>{if(!on)return;const b=new Blob(chunks,{type:'audio/webm'});chunks=[];await rec(b);if(on)record()};record()}catch(e){msg("Mic denied");console.error(e)}}function record(){if(!on||!mr)return;chunks=[];mr.start();document.getElementById("st").textContent="Recording...";setTimeout(()=>{if(mr&&mr.state==='recording')mr.stop()},5000)}async function rec(b){document.getElementById("st").textContent="Identifying...";try{const f=new FormData();f.append('file',b,'a.webm');f.append('api_token',API);f.append('return','apple_music,spotify');const r=await fetch('https://api.audd.io/',{method:'POST',body:f});const d=await r.json();if(d.status==='success'&&d.result){const x=d.result;set({t:x.title||'Unknown',a:x.artist||'Unknown',al:x.album||'',y:x.release_date?x.release_date.substring(0,4):''})}else{document.getElementById("st").textContent="No match - listening..."}}catch(e){console.error(e);document.getElementById("st").textContent="Error - retrying..."}}function stop(){on=0;if(mr&&mr.state==='recording')mr.stop();mr=null;ui();msg("Stopped")}function ui(){document.getElementById("v").classList.toggle("on",on);document.getElementById("b").classList.toggle("on",on);document.getElementById("b").textContent=on?"Stop":"Start Listening";document.getElementById("st").textContent=on?"Listening...":"Tap to begin";document.getElementById("st").classList.toggle("on",on)}function set(s){if(cur&&cur.t===s.t)return;if(cur){prv={...cur};rPrv()}cur={...s,at:Date.now()};rNow();msg("Detected: "+s.t)}function rNow(){document.getElementById("now").innerHTML=cur?`<h3>${cur.t}</h3><p class="a">${cur.a}</p><p class="m">${cur.al}${cur.al&&cur.y?' · ':''}${cur.y}</p><span class="live">● Live</span>`:'<div class="empty">Start listening</div>'}function rPrv(){document.getElementById("prv").innerHTML=prv?`<h3>${prv.t}</h3><p class="a">${prv.a}</p><p class="m">${prv.al}${prv.al&&prv.y?' · ':''}${prv.y}</p>`:'<div class="empty">No previous</div>'}function msg(m){let t=document.getElementById("toast");t.textContent=m;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),3e3)}</script></body></html>
